CREATE DATABASE IF NOT EXISTS telco_churn_v2
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;

USE telco_churn_v2;

CREATE TABLE Contracts (
    ContractID INT NOT NULL AUTO_INCREMENT,
    Type VARCHAR(20) NOT NULL UNIQUE,
    PRIMARY KEY (ContractID)
);

CREATE TABLE PaymentMethods (
    PaymentMethodID INT NOT NULL AUTO_INCREMENT,
    Type VARCHAR(50) NOT NULL UNIQUE,
    PRIMARY KEY (PaymentMethodID)
);

CREATE TABLE InternetServices (
    InternetServiceID INT NOT NULL AUTO_INCREMENT,
    Type VARCHAR(20) NOT NULL UNIQUE,
    PRIMARY KEY (InternetServiceID)
);

CREATE TABLE Customers (
    customerID VARCHAR(10) NOT NULL,
    gender ENUM('Female', 'Male') NOT NULL,
    SeniorCitizen TINYINT(1) NOT NULL,
    Partner ENUM('Yes', 'No') NOT NULL,
    Dependents ENUM('Yes', 'No') NOT NULL,
    tenure INT NOT NULL,
    MonthlyCharges DECIMAL(10, 2) NOT NULL,
    TotalCharges DECIMAL(10, 2),
    Churn ENUM('Yes', 'No') NOT NULL,
    PaperlessBilling ENUM('Yes', 'No') NOT NULL,
    ContractID INT NOT NULL,
    PaymentMethodID INT NOT NULL,
    PRIMARY KEY (customerID),
    FOREIGN KEY (ContractID) REFERENCES Contracts(ContractID)
        ON UPDATE CASCADE
        ON DELETE RESTRICT,
    FOREIGN KEY (PaymentMethodID) REFERENCES PaymentMethods(PaymentMethodID)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);

CREATE TABLE ServiceDetails (
    customerID VARCHAR(10) NOT NULL,
    InternetServiceID INT NOT NULL,
    PhoneService ENUM('Yes', 'No') NOT NULL,
    MultipleLines VARCHAR(20) NOT NULL,
    OnlineSecurity VARCHAR(20) NOT NULL,
    OnlineBackup VARCHAR(20) NOT NULL,
    DeviceProtection VARCHAR(20) NOT NULL,
    TechSupport VARCHAR(20) NOT NULL,
    StreamingTV VARCHAR(20) NOT NULL,
    StreamingMovies VARCHAR(20) NOT NULL,
    PRIMARY KEY (customerID),
    FOREIGN KEY (customerID) REFERENCES Customers(customerID)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
    FOREIGN KEY (InternetServiceID) REFERENCES InternetServices(InternetServiceID)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);

INSERT INTO Contracts (Type) VALUES
('Month-to-month'),
('One year'),
('Two year');

INSERT INTO PaymentMethods (Type) VALUES
('Electronic check'),
('Mailed check'),
('Bank transfer (automatic)'),
('Credit card (automatic)');

INSERT INTO InternetServices (Type) VALUES
('DSL'),
('Fiber optic'),
('No');
